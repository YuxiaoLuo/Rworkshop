<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Markus Loecher, Berlin School of Economics and Law" />


<title>Day 2: Modeling in R</title>

<script src="Day2_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Day2_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Day2_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Day2_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Day2_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Day2_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="Day2_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="Day2_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="Day2_files/navigation-1.1/tabsets.js"></script>
<link href="Day2_files/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="Day2_files/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Day 2: Modeling in R</h1>
<h4 class="author"><em>Markus Loecher, Berlin School of Economics and Law</em></h4>

</div>


<div id="data-manipulation" class="section level1">
<h1><span class="header-section-number">1</span> Data manipulation</h1>
<div id="data-nycflights13" class="section level2">
<h2><span class="header-section-number">1.1</span> Data: nycflights13</h2>
<p>To explore the basic data manipulation verbs of dplyr, we’ll start with the built in <code>nycflights13</code> data frame. This dataset contains all 336776 flights that departed from New York City in 2013. The data comes from the US <a href="http://www.transtats.bts.gov/DatabaseInfo.asp?DB_ID=120&amp;Link=0">Bureau of Transportation Statistics</a>, and is documented in <code>?nycflights13</code></p>
<pre class="r"><code>library(nycflights13)</code></pre>
<pre><code>## Warning: package &#39;nycflights13&#39; was built under R version 3.3.3</code></pre>
<pre class="r"><code>dim(flights)</code></pre>
<pre><code>## [1] 336776     19</code></pre>
<pre class="r"><code>head(flights)</code></pre>
<pre><code>## # A tibble: 6 × 19
##    year month   day dep_time sched_dep_time dep_delay arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1  2013     1     1      517            515         2      830
## 2  2013     1     1      533            529         4      850
## 3  2013     1     1      542            540         2      923
## 4  2013     1     1      544            545        -1     1004
## 5  2013     1     1      554            600        -6      812
## 6  2013     1     1      554            558        -4      740
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<p>dplyr can work with data frames as is, but if you’re dealing with large data, it’s worthwhile to convert them to a <code>tbl_df</code>: this is a wrapper around a data frame that won’t accidentally print a lot of data to the screen.</p>
<div id="single-table-verbs" class="section level3">
<h3><span class="header-section-number">1.1.1</span> Single table verbs</h3>
<p>Dplyr aims to provide a function for each basic verb of data manipulation:</p>
<ul>
<li><code>filter()</code> (and <code>slice()</code>)</li>
<li><code>arrange()</code></li>
<li><code>select()</code> (and <code>rename()</code>)</li>
<li><code>distinct()</code></li>
<li><code>mutate()</code> (and <code>transmute()</code>)</li>
<li><code>summarise()</code></li>
<li><code>sample_n()</code> (and <code>sample_frac()</code>)</li>
</ul>
<p>If you’ve used plyr before, many of these will be familar.</p>
</div>
<div id="filter-rows-with-filter" class="section level3">
<h3><span class="header-section-number">1.1.2</span> Filter rows with <code>filter()</code></h3>
<p><code>filter()</code> allows you to select a subset of rows in a data frame. The first argument is the name of the data frame. The second and subsequent arguments are the expressions that filter the data frame:</p>
<p>For example, we can select all flights on January 1st with:</p>
<pre class="r"><code>library(dplyr)
filter(flights, month == 1, day == 1)</code></pre>
<pre><code>## # A tibble: 842 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1   2013     1     1      517            515         2      830
## 2   2013     1     1      533            529         4      850
## 3   2013     1     1      542            540         2      923
## 4   2013     1     1      544            545        -1     1004
## 5   2013     1     1      554            600        -6      812
## 6   2013     1     1      554            558        -4      740
## 7   2013     1     1      555            600        -5      913
## 8   2013     1     1      557            600        -3      709
## 9   2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 832 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>This is equivalent to the more verbose code in base R:</p>
<pre class="r"><code>flights[flights$month == 1 &amp; flights$day == 1, ]</code></pre>
<p>To select rows by position, use <code>slice()</code>:</p>
<pre class="r"><code>slice(flights, 1:10)</code></pre>
<pre><code>## # A tibble: 10 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1   2013     1     1      517            515         2      830
## 2   2013     1     1      533            529         4      850
## 3   2013     1     1      542            540         2      923
## 4   2013     1     1      544            545        -1     1004
## 5   2013     1     1      554            600        -6      812
## 6   2013     1     1      554            558        -4      740
## 7   2013     1     1      555            600        -5      913
## 8   2013     1     1      557            600        -3      709
## 9   2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="arrange-rows-with-arrange" class="section level3">
<h3><span class="header-section-number">1.1.3</span> Arrange rows with <code>arrange()</code></h3>
<p><code>arrange()</code> works similarly to <code>filter()</code> except that instead of filtering or selecting rows, it reorders them. It takes a data frame, and a set of column names (or more complicated expressions) to order by. If you provide more than one column name, each additional column will be used to break ties in the values of preceding columns:</p>
<pre class="r"><code>arrange(flights, year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1   2013     1     1      517            515         2      830
## 2   2013     1     1      533            529         4      850
## 3   2013     1     1      542            540         2      923
## 4   2013     1     1      544            545        -1     1004
## 5   2013     1     1      554            600        -6      812
## 6   2013     1     1      554            558        -4      740
## 7   2013     1     1      555            600        -5      913
## 8   2013     1     1      557            600        -3      709
## 9   2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Use <code>desc()</code> to order a column in descending order:</p>
<pre class="r"><code>arrange(flights, desc(arr_delay))</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1   2013     1     9      641            900      1301     1242
## 2   2013     6    15     1432           1935      1137     1607
## 3   2013     1    10     1121           1635      1126     1239
## 4   2013     9    20     1139           1845      1014     1457
## 5   2013     7    22      845           1600      1005     1044
## 6   2013     4    10     1100           1900       960     1342
## 7   2013     3    17     2321            810       911      135
## 8   2013     7    22     2257            759       898      121
## 9   2013    12     5      756           1700       896     1058
## 10  2013     5     3     1133           2055       878     1250
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="select-columns-with-select" class="section level3">
<h3><span class="header-section-number">1.1.4</span> Select columns with <code>select()</code></h3>
<p>Often you work with large datasets with many columns but only a few are actually of interest to you. <code>select()</code> allows you to rapidly zoom in on a useful subset using operations that usually only work on numeric variable positions:</p>
<pre class="r"><code># Select columns by name
select(flights, year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1   2013     1     1
## 2   2013     1     1
## 3   2013     1     1
## 4   2013     1     1
## 5   2013     1     1
## 6   2013     1     1
## 7   2013     1     1
## 8   2013     1     1
## 9   2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<pre class="r"><code># Select all columns between year and day (inclusive)
select(flights, year:day)</code></pre>
<pre><code>## # A tibble: 336,776 × 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1   2013     1     1
## 2   2013     1     1
## 3   2013     1     1
## 4   2013     1     1
## 5   2013     1     1
## 6   2013     1     1
## 7   2013     1     1
## 8   2013     1     1
## 9   2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<pre class="r"><code># Select all columns except those from year to day (inclusive)
select(flights, -(year:day))</code></pre>
<pre><code>## # A tibble: 336,776 × 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
## 1       517            515         2      830            819        11
## 2       533            529         4      850            830        20
## 3       542            540         2      923            850        33
## 4       544            545        -1     1004           1022       -18
## 5       554            600        -6      812            837       -25
## 6       554            558        -4      740            728        12
## 7       555            600        -5      913            854        19
## 8       557            600        -3      709            723       -14
## 9       557            600        -3      838            846        -8
## 10      558            600        -2      753            745         8
## # ... with 336,766 more rows, and 10 more variables: carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>You can rename variables with <code>select()</code> by using named arguments:</p>
<pre class="r"><code>select(flights, tail_num = tailnum)</code></pre>
<pre><code>## # A tibble: 336,776 × 1
##    tail_num
##       &lt;chr&gt;
## 1    N14228
## 2    N24211
## 3    N619AA
## 4    N804JB
## 5    N668DN
## 6    N39463
## 7    N516JB
## 8    N829AS
## 9    N593JB
## 10   N3ALAA
## # ... with 336,766 more rows</code></pre>
<p>But because <code>select()</code> drops all the variables not explicitly mentioned, it’s not that useful. Instead, use <code>rename()</code>:</p>
<pre class="r"><code>rename(flights, tail_num = tailnum)</code></pre>
<pre><code>## # A tibble: 336,776 × 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1   2013     1     1      517            515         2      830
## 2   2013     1     1      533            529         4      850
## 3   2013     1     1      542            540         2      923
## 4   2013     1     1      544            545        -1     1004
## 5   2013     1     1      554            600        -6      812
## 6   2013     1     1      554            558        -4      740
## 7   2013     1     1      555            600        -5      913
## 8   2013     1     1      557            600        -3      709
## 9   2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tail_num &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="extract-distinct-unique-rows" class="section level3">
<h3><span class="header-section-number">1.1.5</span> Extract distinct (unique) rows</h3>
<p>Use <code>distinct()</code>to find unique values in a table:</p>
<pre class="r"><code>distinct(flights, tailnum)</code></pre>
<pre><code>## # A tibble: 4,044 × 1
##    tailnum
##      &lt;chr&gt;
## 1   N14228
## 2   N24211
## 3   N619AA
## 4   N804JB
## 5   N668DN
## 6   N39463
## 7   N516JB
## 8   N829AS
## 9   N593JB
## 10  N3ALAA
## # ... with 4,034 more rows</code></pre>
<pre class="r"><code>distinct(flights, origin, dest)</code></pre>
<pre><code>## # A tibble: 224 × 2
##    origin  dest
##     &lt;chr&gt; &lt;chr&gt;
## 1     EWR   IAH
## 2     LGA   IAH
## 3     JFK   MIA
## 4     JFK   BQN
## 5     LGA   ATL
## 6     EWR   ORD
## 7     EWR   FLL
## 8     LGA   IAD
## 9     JFK   MCO
## 10    LGA   ORD
## # ... with 214 more rows</code></pre>
<p>(This is very similar to <code>base::unique()</code> but should be much faster.)</p>
</div>
<div id="add-new-columns-with-mutate" class="section level3">
<h3><span class="header-section-number">1.1.6</span> Add new columns with <code>mutate()</code></h3>
<p>Besides selecting sets of existing columns, it’s often useful to add new columns that are functions of existing columns. This is the job of <code>mutate()</code>:</p>
<pre class="r"><code>mutate(flights,
  gain = arr_delay - dep_delay,
  speed = distance / air_time * 60)</code></pre>
<pre><code>## # A tibble: 336,776 × 21
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1   2013     1     1      517            515         2      830
## 2   2013     1     1      533            529         4      850
## 3   2013     1     1      542            540         2      923
## 4   2013     1     1      544            545        -1     1004
## 5   2013     1     1      554            600        -6      812
## 6   2013     1     1      554            558        -4      740
## 7   2013     1     1      555            600        -5      913
## 8   2013     1     1      557            600        -3      709
## 9   2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 14 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, gain &lt;dbl&gt;, speed &lt;dbl&gt;</code></pre>
<p>mutate allows you to refer to columns that you’ve just created:</p>
<pre class="r"><code>mutate(flights,
  gain = arr_delay - dep_delay,
  gain_per_hour = gain / (air_time / 60)
)</code></pre>
<pre><code>## # A tibble: 336,776 × 21
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1   2013     1     1      517            515         2      830
## 2   2013     1     1      533            529         4      850
## 3   2013     1     1      542            540         2      923
## 4   2013     1     1      544            545        -1     1004
## 5   2013     1     1      554            600        -6      812
## 6   2013     1     1      554            558        -4      740
## 7   2013     1     1      555            600        -5      913
## 8   2013     1     1      557            600        -3      709
## 9   2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 14 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, gain &lt;dbl&gt;, gain_per_hour &lt;dbl&gt;</code></pre>
</div>
<div id="summarise-values-with-summarise" class="section level3">
<h3><span class="header-section-number">1.1.7</span> Summarise values with <code>summarise()</code></h3>
<p>The last verb is <code>summarise()</code>. It collapses a data frame to a single row (this is exactly equivalent to <code>plyr::summarise()</code>):</p>
<pre class="r"><code>summarise(flights,
  delay = mean(dep_delay, na.rm = TRUE))</code></pre>
<pre><code>## # A tibble: 1 × 1
##      delay
##      &lt;dbl&gt;
## 1 12.63907</code></pre>
<p>Below, we’ll see how this verb can be very useful.</p>
</div>
<div id="grouped-operations" class="section level3">
<h3><span class="header-section-number">1.1.8</span> Grouped operations</h3>
<p>These verbs are useful on their own, but they become really powerful when you apply them to groups of observations within a dataset. In dplyr, you do this by with the <code>group_by()</code> function. It breaks down a dataset into specified groups of rows. When you then apply the verbs above on the resulting object they’ll be automatically applied “by group”. Most importantly, all this is achieved by using the same exact syntax you’d use with an ungrouped object.</p>
<p>In the following example, we split the complete dataset into individual planes and then summarise each plane by counting the number of flights (<code>count = n()</code>) and computing the average distance (<code>dist = mean(Distance, na.rm = TRUE)</code>) and arrival delay (<code>delay = mean(ArrDelay, na.rm = TRUE)</code>). We then use ggplot2 to display the output.</p>
<pre class="r"><code>by_tailnum &lt;- group_by(flights, tailnum)
delay &lt;- summarise(by_tailnum,
  count = n(),
  dist = mean(distance, na.rm = TRUE),
  delay = mean(arr_delay, na.rm = TRUE))
delay &lt;- filter(delay, count &gt; 20, dist &lt; 2000)

# Interestingly, the average delay is only slightly related to the
# average distance flown by a plane.
library(ggplot2)
ggplot(delay, aes(dist, delay)) +
  geom_point(aes(size = count), alpha = 1/2) +
  geom_smooth() +
  scale_size_area()</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-14-1.png" width="576" /></p>
<p>You use <code>summarise()</code> with <strong>aggregate functions</strong>, which take a vector of values and return a single number. There are many useful examples of such functions in base R like <code>min()</code>, <code>max()</code>, <code>mean()</code>, <code>sum()</code>, <code>sd()</code>, <code>median()</code>, and <code>IQR()</code>. dplyr provides a handful of others:</p>
<ul>
<li><p><code>n()</code>: the number of observations in the current group</p></li>
<li><p><code>n_distinct(x)</code>:the number of unique values in <code>x</code>.</p></li>
<li><p><code>first(x)</code>, <code>last(x)</code> and <code>nth(x, n)</code> - these work similarly to <code>x[1]</code>, <code>x[length(x)]</code>, and <code>x[n]</code> but give you more control over the result if the value is missing.</p></li>
</ul>
<p>For example, we could use these to find the number of planes and the number of flights that go to each possible destination:</p>
<pre class="r"><code>destinations &lt;- group_by(flights, dest)
summarise(destinations,
  planes = n_distinct(tailnum),
  flights = n()
)</code></pre>
<pre><code>## # A tibble: 105 × 3
##     dest planes flights
##    &lt;chr&gt;  &lt;int&gt;   &lt;int&gt;
## 1    ABQ    108     254
## 2    ACK     58     265
## 3    ALB    172     439
## 4    ANC      6       8
## 5    ATL   1180   17215
## 6    AUS    993    2439
## 7    AVL    159     275
## 8    BDL    186     443
## 9    BGR     46     375
## 10   BHM     45     297
## # ... with 95 more rows</code></pre>
</div>
</div>
<div id="titanic" class="section level2">
<h2><span class="header-section-number">1.2</span> Titanic</h2>
<pre class="r"><code>train &lt;- read.csv(&quot;data/TitanicTrain.csv&quot;)</code></pre>
<p>The disaster was famous for saving “women and children first”, so let’s take a look at the Sex and Age variables to see if any patterns are evident. We’ll start with the gender of the passengers. After reloading the data into R, take a look at the summary of this variable:</p>
<pre class="r"><code>round(prop.table(table(train$Sex, train$Survived),1),2)</code></pre>
<pre><code>##         
##             0    1
##   female 0.26 0.74
##   male   0.81 0.19</code></pre>
<p>Let’s create a new variable, “Child”, to indicate whether the passenger is below the age of 18:</p>
<pre class="r"><code>train$Child &lt;- 0
train$Child[train$Age &lt; 18] &lt;- 1</code></pre>
<p>Now we want to create a table with both gender and age to see the survival proportions for different subsets. Recall the dplyr version of the aggregate function:</p>
<pre class="r"><code>suppressPackageStartupMessages(require(dplyr))
summarise(group_by(train, Sex, Child), round(mean(Survived),2), length(Survived))</code></pre>
<pre><code>## Source: local data frame [4 x 4]
## Groups: Sex [?]
## 
##      Sex Child `round(mean(Survived), 2)` `length(Survived)`
##   &lt;fctr&gt; &lt;dbl&gt;                      &lt;dbl&gt;              &lt;int&gt;
## 1 female     0                       0.75                259
## 2 female     1                       0.69                 55
## 3   male     0                       0.17                519
## 4   male     1                       0.40                 58</code></pre>
<p>While the class variable is limited to a manageable 3 values, the fare is again a continuous variable that needs to be reduced to something that can be easily tabulated. Let’s bin the fares into less than $10, between $10 and $20, $20 to $30 and more than $30 and store it to a new variable:</p>
<pre class="r"><code>train$Fare2 &lt;- &#39;30+&#39;
 train$Fare2[train$Fare &lt; 30 &amp; train$Fare &gt;= 20] &lt;- &#39;20-30&#39;
 train$Fare2[train$Fare &lt; 20 &amp; train$Fare &gt;= 10] &lt;- &#39;10-20&#39;
train$Fare2[train$Fare &lt; 10] &lt;- &#39;&lt;10&#39;</code></pre>
<ul>
<li><p>Use the summarise function to compute the proportions and in each group defined by child, gender and Fare2:</p></li>
<li>Find strong differences between male/female survival probabilities.</li>
<li><p>Partition your data into even finer subgroups, e.g. age and/or embarkation port and repeat.</p></li>
</ul>
<pre><code>## Source: local data frame [41 x 6]
## Groups: Child, Fare2, Sex [?]
## 
##    Child Fare2    Sex Embarked `round(mean(Survived), 2)`
##    &lt;dbl&gt; &lt;chr&gt; &lt;fctr&gt;   &lt;fctr&gt;                      &lt;dbl&gt;
## 1      0   &lt;10 female        C                       1.00
## 2      0   &lt;10 female        Q                       0.70
## 3      0   &lt;10 female        S                       0.44
## 4      0   &lt;10   male        C                       0.13
## 5      0   &lt;10   male        Q                       0.07
## 6      0   &lt;10   male        S                       0.10
## 7      0 10-20 female        C                       0.44
## 8      0 10-20 female        Q                       0.83
## 9      0 10-20 female        S                       0.76
## 10     0 10-20   male        C                       0.45
## # ... with 31 more rows, and 1 more variables: `length(Survived)` &lt;int&gt;</code></pre>
<hr />
</div>
</div>
<div id="descriptive-statistics" class="section level1">
<h1><span class="header-section-number">2</span> Descriptive statistics</h1>
<div id="measures-of-central-tendency" class="section level2">
<h2><span class="header-section-number">2.1</span> Measures of Central tendency</h2>
<pre class="r"><code>mean(flights$dep_delay)</code></pre>
<pre><code>## [1] NA</code></pre>
<pre class="r"><code>mean(flights$dep_delay, na.rm=T)</code></pre>
<pre><code>## [1] 12.63907</code></pre>
<pre class="r"><code>median(flights$dep_delay, na.rm=T)</code></pre>
<pre><code>## [1] -2</code></pre>
<pre class="r"><code>#robustness
mean(flights$dep_delay, na.rm=T, trim = 0.1)</code></pre>
<pre><code>## [1] 3.320257</code></pre>
</div>
<div id="dispersion-measures" class="section level2">
<h2><span class="header-section-number">2.2</span> Dispersion measures</h2>
<p>Only sample stdev is included!</p>
<pre class="r"><code>#var

sd(flights$dep_delay, na.rm=T)</code></pre>
<pre><code>## [1] 40.21006</code></pre>
<pre class="r"><code>IQR(flights$dep_delay, na.rm=T)</code></pre>
<pre><code>## [1] 16</code></pre>
<pre class="r"><code>mad(flights$dep_delay, na.rm=T)</code></pre>
<pre><code>## [1] 5.9304</code></pre>
</div>
<div id="descriptive-boxplots" class="section level2">
<h2><span class="header-section-number">2.3</span> Descriptive boxplots</h2>
<pre class="r"><code>#define our own transformation
require(scales) # trans_new() is in the scales library
sign_sqrt_trans = function() trans_new(&quot;sign_sqrt&quot;, function(x) sign(x)*sqrt(abs(x)), function(x) sign(x)*x^2)</code></pre>
<div id="delays-by-carrier" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Delays by carrier</h3>
<pre class="r"><code>if (baseR){
  boxplot(arr_delay ~ carrier, data=flights)
  grid()
} else {
  p = ggplot(flights, aes( carrier,arr_delay))
  p + geom_boxplot() + coord_trans(y=&quot;sign_sqrt&quot;) #+ scale_y_sqrt()
}</code></pre>
<pre><code>## Warning: Removed 9430 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>There appear to be significant delays by time-of-day:</p>
<pre class="r"><code>if (baseR){
  boxplot(arr_delay ~ hour, data=flights)
  grid()
} else {
  p = ggplot(flights, aes( factor(hour),arr_delay))
  p + geom_boxplot() + coord_trans(y=&quot;sign_sqrt&quot;) #+ scale_y_sqrt()
}</code></pre>
<pre><code>## Warning: Removed 9430 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-27-1.png" width="960" /></p>
<hr />
</div>
</div>
</div>
<div id="basic-statistical-tests" class="section level1">
<h1><span class="header-section-number">3</span> Basic statistical tests</h1>
<p>I have prepared a data file for you:</p>
<pre class="r"><code>print(load(&quot;data/BirthWeights.rda&quot;))</code></pre>
<pre><code>## [1] &quot;x&quot;</code></pre>
<pre class="r"><code>class(x$gender)</code></pre>
<pre><code>## [1] &quot;factor&quot;</code></pre>
<pre class="r"><code>#split the plotting region into 2 columns:
par(mfrow=c(1,2))
boxplot(dbirwt ~ gender, data=x)
hist(x$dbirwt, xlab=&quot;birth weight [g]&quot;)</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-28-1.png" width="960" /></p>
<div id="remove-outliers" class="section level2">
<h2><span class="header-section-number">3.1</span> remove outliers</h2>
<pre class="r"><code>#either:
ii = which(x$dbirwt&gt; 8000)
x = x[-ii,]

#or:
x = subset(x, dbirwt &lt;= 8000)</code></pre>
</div>
<div id="density-plot" class="section level2">
<h2><span class="header-section-number">3.2</span> density plot</h2>
<pre class="r"><code>library(ggplot2)
ggplot(x, aes(dbirwt, fill=gender)) + geom_density(alpha=.5) + 
  scale_fill_manual(values = c(&quot;orange&quot;, &quot;purple&quot;)) # +   theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div id="t-test" class="section level3">
<h3><span class="header-section-number">3.2.1</span> t-test</h3>
<p>Can we detect the difference in birth weights?</p>
<pre class="r"><code>boys = subset(x, gender == &quot;male&quot;)$dbirwt
girls = subset(x, gender == &quot;female&quot;)$dbirwt
  
t.test(x=boys, y=girls)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  boys and girls
## t = 30.07, df = 99925, p-value &lt; 2.2e-16
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  109.6238 124.9108
## sample estimates:
## mean of x mean of y 
##  3309.642  3192.375</code></pre>
<p>Would a small sample suffice?</p>
<pre class="r"><code>set.seed(1234)

b=sample(boys,100);g=sample(girls,100)

t.test(b,g)</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  b and g
## t = 0.51544, df = 195.65, p-value = 0.6068
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -148.5721  253.7121
## sample estimates:
## mean of x mean of y 
##   3225.44   3172.87</code></pre>
<p>What about these non integer degrees of freedom??</p>
</div>
<div id="f-test-for-variances" class="section level3">
<h3><span class="header-section-number">3.2.2</span> F-test for variances</h3>
<pre class="r"><code>var.test(b,g)</code></pre>
<pre><code>## 
##  F test to compare two variances
## 
## data:  b and g
## F = 1.2461, num df = 99, denom df = 99, p-value = 0.2753
## alternative hypothesis: true ratio of variances is not equal to 1
## 95 percent confidence interval:
##  0.8384494 1.8520431
## sample estimates:
## ratio of variances 
##           1.246132</code></pre>
</div>
<div id="prop-test" class="section level3">
<h3><span class="header-section-number">3.2.3</span> prop-test</h3>
<pre class="r"><code>(gs = table(train$Sex, train$Survived))</code></pre>
<pre><code>##         
##            0   1
##   female  81 233
##   male   468 109</code></pre>
<pre class="r"><code>prop.test(gs)</code></pre>
<pre><code>## 
##  2-sample test for equality of proportions with continuity
##  correction
## 
## data:  gs
## X-squared = 260.72, df = 1, p-value &lt; 2.2e-16
## alternative hypothesis: two.sided
## 95 percent confidence interval:
##  -0.6135708 -0.4926894
## sample estimates:
##    prop 1    prop 2 
## 0.2579618 0.8110919</code></pre>
</div>
<div id="exact-binomial-test" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Exact Binomial Test</h3>
<pre class="r"><code>binom.test(gs[1,2:1], p=0.75)</code></pre>
<pre><code>## 
##  Exact binomial test
## 
## data:  gs[1, 2:1]
## number of successes = 233, number of trials = 314, p-value =
## 0.7447
## alternative hypothesis: true probability of success is not equal to 0.75
## 95 percent confidence interval:
##  0.6899084 0.7895366
## sample estimates:
## probability of success 
##              0.7420382</code></pre>
<hr />
</div>
</div>
</div>
<div id="linear-models" class="section level1">
<h1><span class="header-section-number">4</span> Linear Models</h1>
<div id="correlation" class="section level2">
<h2><span class="header-section-number">4.1</span> correlation</h2>
<div id="are-arrival-and-departure-delay-correlated" class="section level4">
<h4><span class="header-section-number">4.1.0.1</span> Are arrival and departure delay correlated?</h4>
<pre class="r"><code>if (baseR){
  plot(arr_delay ~ dep_delay, data=flights, pch=20,cex=0.5,col=carrier)
  grid()
} else {
  p = ggplot(flights, aes( dep_delay,arr_delay, col=carrier ))
  p + geom_point( alpha=0.5, size=1) + coord_trans(x=&quot;sign_sqrt&quot;, y=&quot;sign_sqrt&quot;) # +  geom_smooth(method=lm) 
}</code></pre>
<pre><code>## Warning: Removed 9430 rows containing missing values (geom_point).</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-36-1.png" width="768" /></p>
<pre class="r"><code>cor(flights$dep_delay,flights$arr_delay, use = &quot;complete.obs&quot;,method = &quot;pearson&quot;)</code></pre>
<pre><code>## [1] 0.9148028</code></pre>
<pre class="r"><code>#slooow    
#cor(flights$dep_delay,flights$arr_delay, use = &quot;complete.obs&quot;,method = &quot;kendall&quot;)
  
#cor(flights$dep_delay,flights$arr_delay, use = &quot;complete.obs&quot;,method = &quot;spearman&quot;)

Shortdelays = filter(flights, abs(arr_delay)&lt;100 &amp; abs(dep_delay)&lt;100)

cor(Shortdelays$dep_delay,Shortdelays$arr_delay, use = &quot;complete.obs&quot;,method = &quot;pearson&quot;)</code></pre>
<pre><code>## [1] 0.7562735</code></pre>
<pre class="r"><code>#plot(arr_delay ~ dep_delay,data=Shortdelays)</code></pre>
</div>
</div>
<div id="simple-regression" class="section level2">
<h2><span class="header-section-number">4.2</span> simple regression</h2>
<div id="mpg-vs.weight" class="section level3">
<h3><span class="header-section-number">4.2.1</span> mpg vs. weight</h3>
<pre class="r"><code>library(ISLR);data(Auto)
plot(mpg ~ weight, data = Auto,col = rgb(0,0,1,0.5), pch=20,xlim=c(250, 7000), ylim = c(0,45));grid()
LSfit = lm(mpg ~ weight, data = Auto)

#overlay regression line
abline(LSfit, col=2)</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<pre class="r"><code>#summary
summary(LSfit)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mpg ~ weight, data = Auto)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -11.9736  -2.7556  -0.3358   2.1379  16.5194 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 46.216524   0.798673   57.87   &lt;2e-16 ***
## weight      -0.007647   0.000258  -29.64   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 4.333 on 390 degrees of freedom
## Multiple R-squared:  0.6926, Adjusted R-squared:  0.6918 
## F-statistic: 878.8 on 1 and 390 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>#diagnostics
plot(LSfit, c(1,2,5))</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-37-2.png" width="672" /><img src="Day2_files/figure-html/unnamed-chunk-37-3.png" width="672" /><img src="Day2_files/figure-html/unnamed-chunk-37-4.png" width="672" /></p>
<p><strong>Tasks</strong></p>
<ol style="list-style-type: decimal">
<li>Predict mpg for a car that weighs 5000 lbs.</li>
<li>Confidence Interval for slope</li>
<li>Are the least squares assumptions met?</li>
<li>Add 3 outliers to the data:</li>
</ol>
<ul>
<li>weight=500, mpg = 40</li>
<li>weight=<span class="math inline">\(10^4\)</span>, mpg = 80</li>
<li>weight=3000, mpg = 80</li>
</ul>
<p>Points that fall horizontally far from the line are points of high leverage; these points can strongly influence the slope of the least squares line. If one of these high leverage points does appear to actually invoke its in uence on the slope of the line then we call it an in uential point. Usually we can say a point is influential if, had we fitted the line without it, the influential point would have been unusually far from the least squares line.</p>
<pre class="r"><code>par(mfrow=c(1,3), cex=1.4)

outlrs = cbind(weight=c(500,10000,3000),mpg=c(40,80,80))
Auto2 = Auto

fit=list()
for (i in 1:3){
  Auto2[1,c(&quot;weight&quot;,&quot;mpg&quot;)] = outlrs[i,]
  
  plot(mpg ~ weight, data = Auto2,col = rgb(1,0.894,0.769,0.5), pch=20);grid()
  #overlay regression line
  abline(LSfit, col=2, lwd=2.5)
  fit[[i]] = lm(mpg ~ weight, data = Auto2) 
  points(Auto2[1,c(&quot;weight&quot;,&quot;mpg&quot;)], col = i+2, pch = 18, cex = 2)
  #overlay regression line
  abline(fit[[i]], col=i+2,lwd=2, lty=2)
  #plot(fit[[i]],5)
}</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-38-1.png" width="1152" /></p>
</div>
<div id="global-warming" class="section level3">
<h3><span class="header-section-number">4.2.2</span> global warming</h3>
<pre class="r"><code>Global &lt;- scan(&quot;data/global.dat&quot;)
 Global.ts &lt;- ts(Global, st = c(1856, 1), end = c(2005, 12),
fr = 12)
 Global.annual &lt;- aggregate(Global.ts, FUN = mean)
 plot(Global.ts);grid()
 
Last35 &lt;- window(Global.ts, start=c(1970, 1), end=c(2005, 12))
 Last35Yrs &lt;- time(Last35)
 fitAD=lm(Last35 ~ Last35Yrs)
summary(fitAD)</code></pre>
<pre><code>## 
## Call:
## lm(formula = Last35 ~ Last35Yrs)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.35784 -0.08220 -0.00356  0.07738  0.47024 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -34.920409   1.164899  -29.98   &lt;2e-16 ***
## Last35Yrs     0.017654   0.000586   30.13   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1266 on 430 degrees of freedom
## Multiple R-squared:  0.6785, Adjusted R-squared:  0.6778 
## F-statistic: 907.7 on 1 and 430 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>  abline(fitAD,col=2)</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
</div>
<div id="logistic-regression" class="section level2">
<h2><span class="header-section-number">4.3</span> logistic regression</h2>
<p>Back to the Titanic data. How did the survival probability depend on age?</p>
<pre class="r"><code>fit = glm(Survived ~ Age, family = binomial, data = train)
pander(summary(fit)$coefficients)</code></pre>
<table style="width:86%;">
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">-0.05672</td>
<td align="center">0.1736</td>
<td align="center">-0.3268</td>
<td align="center">0.7438</td>
</tr>
<tr class="even">
<td align="center"><strong>Age</strong></td>
<td align="center">-0.01096</td>
<td align="center">0.00533</td>
<td align="center">-2.057</td>
<td align="center">0.03969</td>
</tr>
</tbody>
</table>
<p><strong>Give a precise interpretation of the slope</strong></p>
<div id="dummiesfactors" class="section level3">
<h3><span class="header-section-number">4.3.1</span> dummies/factors</h3>
<pre class="r"><code>fit = glm(Survived ~ Pclass, family = binomial, data = train)
pander(summary(fit)$coefficients)</code></pre>
<table style="width:86%;">
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">1.447</td>
<td align="center">0.2074</td>
<td align="center">6.975</td>
<td align="center">3.063e-12</td>
</tr>
<tr class="even">
<td align="center"><strong>Pclass</strong></td>
<td align="center">-0.8501</td>
<td align="center">0.08715</td>
<td align="center">-9.755</td>
<td align="center">1.755e-22</td>
</tr>
</tbody>
</table>
<pre class="r"><code>fit = glm(Survived ~ factor(Pclass), family = binomial, data = train)
pander(summary(fit)$coefficients)</code></pre>
<table style="width:92%;">
<colgroup>
<col width="30%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">0.5306</td>
<td align="center">0.1409</td>
<td align="center">3.766</td>
<td align="center">0.0001659</td>
</tr>
<tr class="even">
<td align="center"><strong>factor(Pclass)2</strong></td>
<td align="center">-0.6394</td>
<td align="center">0.2041</td>
<td align="center">-3.133</td>
<td align="center">0.001731</td>
</tr>
<tr class="odd">
<td align="center"><strong>factor(Pclass)3</strong></td>
<td align="center">-1.67</td>
<td align="center">0.1759</td>
<td align="center">-9.496</td>
<td align="center">2.187e-21</td>
</tr>
</tbody>
</table>
<pre class="r"><code>fit = glm(Survived ~ factor(Pclass) -1, family = binomial, data = train)
pander(summary(fit)$coefficients)</code></pre>
<table style="width:92%;">
<colgroup>
<col width="30%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>factor(Pclass)1</strong></td>
<td align="center">0.5306</td>
<td align="center">0.1409</td>
<td align="center">3.766</td>
<td align="center">0.0001659</td>
</tr>
<tr class="even">
<td align="center"><strong>factor(Pclass)2</strong></td>
<td align="center">-0.1088</td>
<td align="center">0.1477</td>
<td align="center">-0.7368</td>
<td align="center">0.4612</td>
</tr>
<tr class="odd">
<td align="center"><strong>factor(Pclass)3</strong></td>
<td align="center">-1.14</td>
<td align="center">0.1053</td>
<td align="center">-10.82</td>
<td align="center">2.697e-27</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="multiple-regression" class="section level2">
<h2><span class="header-section-number">4.4</span> multiple regression</h2>
<pre class="r"><code>fit1=glm(Survived ~ Pclass + Sex + Age + Fare, data = train, family=binomial)
pander(summary(fit1)$coefficients)</code></pre>
<table style="width:86%;">
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">4.988</td>
<td align="center">0.5722</td>
<td align="center">8.717</td>
<td align="center">2.845e-18</td>
</tr>
<tr class="even">
<td align="center"><strong>Pclass</strong></td>
<td align="center">-1.27</td>
<td align="center">0.1586</td>
<td align="center">-8.005</td>
<td align="center">1.198e-15</td>
</tr>
<tr class="odd">
<td align="center"><strong>Sexmale</strong></td>
<td align="center">-2.518</td>
<td align="center">0.2079</td>
<td align="center">-12.12</td>
<td align="center">8.787e-34</td>
</tr>
<tr class="even">
<td align="center"><strong>Age</strong></td>
<td align="center">-0.03671</td>
<td align="center">0.00768</td>
<td align="center">-4.78</td>
<td align="center">1.754e-06</td>
</tr>
<tr class="odd">
<td align="center"><strong>Fare</strong></td>
<td align="center">0.0005373</td>
<td align="center">0.002182</td>
<td align="center">0.2462</td>
<td align="center">0.8055</td>
</tr>
</tbody>
</table>
<p>Second model: take out the (highly significant) variable passenger class</p>
<pre class="r"><code>fit2=glm(Survived ~ Pclass + Sex + Age, data = train, family=binomial)
pander(summary(fit2)$coefficients)</code></pre>
<table style="width:86%;">
<colgroup>
<col width="25%" />
<col width="15%" />
<col width="18%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"> </th>
<th align="center">Estimate</th>
<th align="center">Std. Error</th>
<th align="center">z value</th>
<th align="center">Pr(&gt;|z|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>(Intercept)</strong></td>
<td align="center">5.056</td>
<td align="center">0.5021</td>
<td align="center">10.07</td>
<td align="center">7.563e-24</td>
</tr>
<tr class="even">
<td align="center"><strong>Pclass</strong></td>
<td align="center">-1.289</td>
<td align="center">0.1393</td>
<td align="center">-9.253</td>
<td align="center">2.186e-20</td>
</tr>
<tr class="odd">
<td align="center"><strong>Sexmale</strong></td>
<td align="center">-2.522</td>
<td align="center">0.2073</td>
<td align="center">-12.17</td>
<td align="center">4.626e-34</td>
</tr>
<tr class="even">
<td align="center"><strong>Age</strong></td>
<td align="center">-0.03693</td>
<td align="center">0.007628</td>
<td align="center">-4.841</td>
<td align="center">1.289e-06</td>
</tr>
</tbody>
</table>
<p><strong>Why did the status of the variable Fare change from non-significant to highly significant ?</strong></p>
</div>
<div id="anova" class="section level2">
<h2><span class="header-section-number">4.5</span> ANOVA</h2>
<div id="comparison-of-nested-models" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Comparison of nested models</h3>
<p>See page 130 in the ISL book.</p>
<p>The anova() function performs a hypothesis test comparing the two models. The null hypothesis is that the two models fit the data equally well, and the alternative hypothesis is that the full model is superior.</p>
<pre class="r"><code> fit1=lm(Survived ~ Pclass + Sex + Age + Fare, data = train)
 fit2=lm(Survived ~ Pclass + Sex + Age , data = train)

anova(fit1,fit2)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Model 1: Survived ~ Pclass + Sex + Age + Fare
## Model 2: Survived ~ Pclass + Sex + Age
##   Res.Df    RSS Df  Sum of Sq      F Pr(&gt;F)
## 1    709 105.02                            
## 2    710 105.02 -1 -0.0062101 0.0419 0.8378</code></pre>
</div>
<div id="differences-in-means" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Differences in means</h3>
<p>Are there significant differences in delays by airport in the flight data?</p>
<pre class="r"><code>if (baseR){
  boxplot(arr_delay ~ origin, data=flights)
  grid()
} else {
  p = ggplot(flights, aes( factor(origin),arr_delay))
  p + geom_boxplot() + coord_trans(y=&quot;sign_sqrt&quot;) #+ scale_y_sqrt()
}</code></pre>
<pre><code>## Warning: Removed 9430 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="Day2_files/figure-html/unnamed-chunk-47-1.png" width="960" /></p>
<p>Can we use ANOVA to determine its significance?</p>
<p>Yes, a linear model:</p>
<pre class="r"><code>summary(lm(arr_delay ~ factor(origin) -1, data = flights))</code></pre>
<pre><code>## 
## Call:
## lm(formula = arr_delay ~ factor(origin) - 1, data = flights)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
##  -95.11  -23.78  -11.78    7.22 1266.45 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## factor(origin)EWR   9.1071     0.1303   69.88   &lt;2e-16 ***
## factor(origin)JFK   5.5515     0.1350   41.11   &lt;2e-16 ***
## factor(origin)LGA   5.7835     0.1402   41.24   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 44.6 on 327343 degrees of freedom
##   (9430 observations deleted due to missingness)
## Multiple R-squared:  0.02465,    Adjusted R-squared:  0.02464 
## F-statistic:  2758 on 3 and 327343 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>myAOV = aov(arr_delay ~ factor(origin) -1, data = flights)

summary(myAOV)</code></pre>
<pre><code>##                    Df    Sum Sq Mean Sq F value Pr(&gt;F)    
## factor(origin)      3  16459036 5486345    2758 &lt;2e-16 ***
## Residuals      327343 651219062    1989                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 9430 observations deleted due to missingness</code></pre>
<p>The ANOVA F-test answers the question whether there are significant differences in the K population means. However, it does not provide us with any information about how they differ. Therefore when you reject <span class="math inline">\(H_0\)</span> in ANOVA, additional analyses are required to determine what is driving the difference in means. The function <code>pairwise.t.test</code> computes the pairwise comparisons between group means with corrections for multiple testing.</p>
<pre class="r"><code>pairwise.t.test(flights$arr_delay, flights$origin, adjust=&quot;bonferroni&quot;)</code></pre>
<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  flights$arr_delay and flights$origin 
## 
##     EWR    JFK 
## JFK &lt;2e-16 -   
## LGA &lt;2e-16 0.23
## 
## P value adjustment method: holm</code></pre>
<p>Another multiple comparisons procedure is Tukey???s method. The function <code>TukeyHSD()</code> creates a set of confidence intervals on the differences between means with the specified family-wise probability of coverage:</p>
<pre class="r"><code>TukeyHSD(myAOV)</code></pre>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = arr_delay ~ factor(origin) - 1, data = flights)
## 
## $`factor(origin)`
##               diff        lwr        upr     p adj
## JFK-EWR -3.5555737 -3.9954364 -3.1157110 0.0000000
## LGA-EWR -3.3235665 -3.7722790 -2.8748540 0.0000000
## LGA-JFK  0.2320072 -0.2243113  0.6883257 0.4581547</code></pre>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
